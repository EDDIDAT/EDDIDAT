%% Choice of scattering angle TwoTheta
config.configParameter('TwoTheta',...
	'Value', 11);

psiTmp = [0;4;8;12;16;20;24;28;32;36;40;44;48;52;56;60;64;68;72;74;76;78;80;81;82;83;84;85;86;87;88;89];
for i = 1:numberOfSpecs
	config.configParameter('Psi',...
		'Value', psiTmp(i),...
		'SpecIndex', i);
end

%% Input of photon energies of principal K-, L-shell emmision lines
config.configParameter('FluorPos_K',...
	'Value', zeros(0,1));
config.configParameter('FluorPos_L',...
	'Value', [9.713; 9.628; 11.442; 11.585; 13.382]);
config.configParameter('FluorInt_K',...
	'Value', zeros(0,1));
config.configParameter('FluorInt_L',...
	'Value', [1; 0.25; 0.95; 0.4; 0.17]);

%% Input of the h k l values and multiplicity m values
hklTmp = [1 1 1 8;...
    2 0 0 6;...
    2 2 0 12;...
    3 1 1 24;...
    2 2 2 8;...
    4 0 0 6;...
    3 3 1 24;...
    4 2 0 24;...
    4 2 2 24];...
%     5 1 1 24;...
%     3 3 3 8;...
%     4 4 0 12;...
%     5 3 1 48;...
%     4 4 2 24;...
%     6 0 0 6;...
%     6 2 0 24;...
%     5 3 3 24;...
%     6 2 2 24;...
%     4 4 4 8;...
%     5 5 1 24;...
%     7 1 1 24;...
%     6 4 0 24;...
%     6 4 2 48];
config.configParameter('H',...
	'Value', hklTmp(:,1));
config.configParameter('K',...
	'Value', hklTmp(:,2));
config.configParameter('L',...
	'Value', hklTmp(:,3));
config.configParameter('Multiplicity',...
	'Value', hklTmp(:,4));
config.configParameter('Alpha',...
	'Value', 90);
config.configParameter('Beta',...
	'Value', 90);
config.configParameter('Gamma',...
	'Value', 90);

% Phi = 0
ringCurrentTmp = [299.066;298.404;298.599;299.013;298.295;298.445;298.612;...
	298.74;298.4;298.686;298.858;298.987;298.818;298.48;298.618;298.769;...
	298.855;298.937;298.345;298.489;298.697;298.925;299.076;298.407;298.667;...
	298.8;298.439;298.489;298.677;298.93;298.313;298.534];
% Phi = 90
% ringCurrentTmp = [298.414;298.587;298.722;298.968;298.344;298.641;298.963;...
% 	298.352;298.537;298.851;299.06;299.146;298.49;298.736;298.705;298.924;...
% 	299.081;299.139;298.54;298.668;298.752;298.987;298.362;298.613;298.813;...
% 	299.078;298.5;298.756;299.068;298.504;299.027;298.464];
% Phi = 180
% ringCurrentTmp = [298.909;298.33;298.626;298.839;299.086;298.556;299.09;...
% 	298.803;299.069;298.418;298.855;299.011;298.397;298.606;298.815;299.016;...
% 	298.392;298.637;298.973;298.822;299.141;298.833;299.111;298.53;298.74;...
% 	298.973;298.358;298.848;299.136;298.56;298.825;299.084];
% Phi = 270
% ringCurrentTmp = [298.427;298.693;299.174;299.02;298.441;298.546;298.814;...
% 	299.14;298.463;298.72;299;298.449;298.758;299.128;298.62;298.959;298.489;...
% 	298.916;298.401;298.839;299.23;298.78;298.37;298.806;299.246;298.819;...
% 	298.364;298.783;299.245;298.754;299.184;299.181];

for i = 1:numberOfSpecs
	config.configParameter('RingCurrent',...
		'Value', ringCurrentTmp(i),...
		'SpecIndex', i);
end

% Phi = 0
deadTimeTmp = [37.81666667;36.85555556;36.78888889;36.80555556;37.01111111;...
	37.1;36.32777778;34.31111111;32.09444444;29.48333333;26.96666667;24.5;...
	22.10555556;19.91666667;17.97222222;16.05;13.93333333;12.25555556;...
	10.61111111;9.716666667;8.75;7.75;6.933333333;6.566666667;6.233333333;...
	5.961111111;5.733333333;5.483333333;5.255555556;4.922222222;4.677777778;4.611111111];
% Phi = 90
% deadTimeTmp = [25.93888889;26.60555556;27.78888889;29.03333333;29.71111111;29.43333333;...
% 	28.36666667;27.18888889;25.65;24.03888889;22.17222222;20.19444444;17.96666667;...
% 	15.47222222;13.17222222;11.11666667;9.127777778;7.783333333;6.716666667;6.216666667;...
% 	5.927777778;5.544444444;5.288888889;5.305555556;5.15;5.083333333;5.061111111;...
% 	5.027777778;4.961111111;5;4.994444444;5.127777778];
% Phi = 180
% deadTimeTmp = [37.35555556;38.28888889;38.94444444;38.88888889;38.46111111;...
% 	37.6;36.61666667;34.76666667;32.73888889;30.38888889;27.98333333;25.56666667;...
% 	23.06111111;21.08888889;18.74444444;16.96666667;14.85555556;12.95;10.97222222;...
% 	10.1;9.094444444;8.244444444;7.544444444;7.105555556;6.738888889;6.422222222;...
% 	6.072222222;5.777777778;5.538888889;5.227777778;5.011111111;4.844444444];
% Phi = 270
% deadTimeTmp = [26.66666667;27.66666667;29.30555556;31.18888889;31.71111111;...
% 	30.71666667;29.10555556;27.47777778;25.88888889;24.36111111;22.41666667;...
% 	20.39444444;18.47777778;16.30555556;14.08888889;11.90555556;9.944444444;...
% 	8.344444444;7.055555556;6.4;5.983333333;5.627777778;5.333333333;5.266666667;...
% 	5.244444444;5.194444444;5.177777778;5.094444444;5.038888889;5.072222222;...
% 	5.127777778;5.211111111];

for i = 1:numberOfSpecs
	config.configParameter('DeadTime',...
		'Value', deadTimeTmp(i),...
		'SpecIndex', i);
end

%% Input of the DEK values
DEK_S_Tmp = [-4.202e-006  1.456e-005
			-6.849e-006  2.250e-005
			-4.864e-006  1.654e-005
			-5.602e-006  1.876e-005
			-4.202e-006  1.456e-005
			-6.849e-006  2.250e-005
			-4.671e-006  1.597e-005
			-5.579e-006  1.869e-005
			-4.864e-006  1.654e-005];
% 			-5.602e-006  1.876e-005
% 			-4.202e-006  1.456e-005
% 			-4.864e-006  1.654e-005
% 			-5.170e-006  1.746e-005
% 			-4.671e-006  1.597e-005
% 			-6.849e-006  2.250e-005];
% 			-6.135e-006  2.036e-005
% 			-4.568e-006  1.566e-005];
	
config.configParameter('DEK_S1',...
	'Value', DEK_S_Tmp(:,1));
config.configParameter('DEK_S2',...
	'Value', DEK_S_Tmp(:,2));

%% Input of the attenuation factors
config.configParameter('DensityAir',...
	'Value', 1.2041e-003);
load(fullfile(rvpath,'data','Physics','Air_Absorption.mat'));
config.configParameter('X_airabsorption',...
	'Value', X_airabsorption);
config.configParameter('Y_airabsorption',...
	'Value', Y_airabsorption_en);
config.configParameter('DetectorDistance',...
	'Value', 110);

%% material absorption correction
config.configParameter('Density',...
	'Value', 19.3);
load(fullfile(rvpath,'data','Physics','Au_absorption_XCOM'));
config.configParameter('X_abs',...
	'Value', X_abs);
config.configParameter('Y_abs',...
	'Value', Y_abs);

%% structure factor calculation
% load('C:\Users\hrp\Documents\MATLAB\Rietveld\TestDaten\AtomSF.mat')
% config.configParameter('SF_a',...
% 	'Value', Atomdata(52,[1 3 5 7]));
% config.configParameter('SF_b',...
% 	'Value', Atomdata(52,[2 4 6 8]));
% config.configParameter('SF_c',...
% 	'Value', Atomdata(52,9));
% config.configParameter('APConst',...
% 	'Value', [0 0 0;...
% 				1/2 1/2 1/2]);
% config.configParameter('APFitPattern',...
% 	'Value', [0 0 0;...
% 				0 0 0]);
% config.configParameter('APFitParams',...
% 	'Value', 0);
% config.configParameter('AtomCoordCnts',...
% 	'Value', 0);

%% FitParameter for the FWHM and the line position calibration
config.configParameter('FluorScaleFactor_K',...
	'Value', 1,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorScaleFactor_L',...
	'Value', 1,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorDeltaEnergy_K',...
	'Value', zeros(3,1),...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorDeltaEnergy_L',...
	'Value', zeros(3,1),...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorU_K',...
	'Value', 0.0025,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorW_K',...
	'Value', 0.0005,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorU_L',...
	'Value', 0.0025,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('FluorW_L',...
	'Value', 0.0005,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);

%% Escape peaks
% config.configParameter('EscapeInt_Alpha',...
% 	'Value', ones(4,1));
% config.configParameter('EscapeInt_Beta',...
% 	'Value', ones(4,1));
% config.configParameter('EscapeAlphaInd',...
% 	'Value', [1; 2; 3; 4]);
% config.configParameter('EscapeBetaInd',...
% 	'Value', [1; 2; 3; 4]);
% config.configParameter('EscapeScaleFactor_Alpha',...
% 	'Value', 1,...
% 	'LowerConstraint', 0,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
% config.configParameter('EscapeScaleFactor_Beta',...
% 	'Value', 1,...
% 	'LowerConstraint', 0,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
% config.configParameter('EscapeU_Alpha',...
% 	'Value', 0.0025,...
% 	'LowerConstraint', -Inf,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
% config.configParameter('EscapeU_Beta',...
% 	'Value', 0.0005,...
% 	'LowerConstraint', -Inf,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
% config.configParameter('EscapeW_Alpha',...
% 	'Value', 0.0025,...
% 	'LowerConstraint', -Inf,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
% config.configParameter('EscapeW_Beta',...
% 	'Value', 0.0005,...
% 	'LowerConstraint', -Inf,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);

%% Phase
config.configParameter('ScaleFactor',...
	'Value', 1,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', true);
config.configParameter('StructureFactor',...
	'Value', ones(9,1).*5000,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('DeltaEnergy_a',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('DeltaEnergy_b',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('DeltaEnergy_c',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);

config.configParameter('LatticeParam1',...
	'Value', 4.078,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('LatticeParam2',...
	'Value', 0,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('LatticeParam3',...
	'Value', 0,...
	'LowerConstraint', 0,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
% config.configParameter('StressCoef',...
% 	'Value', [0; 0; 0],...
% 	'LowerConstraint', -Inf,...
% 	'UpperConstraint', +Inf,...
% 	'Refinable', false);
config.configParameter('StressCoef1',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('StressCoef2',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('StressCoef3',...
	'Value', 0,...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', false);
config.configParameter('P_Size',...
	'Value', 0.0005,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('U_Strain',...
	'Value', 0.00005,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('V_Detector',...
	'Value', 0,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('X_Size',...
	'Value', 0.0005,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('Y_Strain',...
	'Value', 0.00005,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('Z_Detector',...
	'Value', 0,...
	'LowerConstraint', 0,...
	'UpperConstraint', 1,...
	'Refinable', false);
config.configParameter('Background',...
	'Value', zeros(5,1),...
	'LowerConstraint', -Inf,...
	'UpperConstraint', +Inf,...
	'Refinable', true);
config.configParameter('MaxAmp',...
	'Value', [30; 55],...
	'LowerConstraint', 0,...
	'UpperConstraint', Inf,...
	'Refinable', false);
config.configParameter('Center',...
	'Value', [14; 48],...
	'LowerConstraint', 0,...
	'UpperConstraint', Inf,...
	'Refinable', false);
config.configParameter('Width',...
	'Value', [8; 29],...
	'LowerConstraint', 0,...
	'UpperConstraint', Inf,...
	'Refinable', false);
config.configParameter('Shape1',...
	'Value', [3.2; 4.8],...
	'LowerConstraint', 0,...
	'UpperConstraint', Inf,...
	'Refinable', false);
config.configParameter('Shape2',...
	'Value', [3.3; 7.9],...
	'LowerConstraint', 0,...
	'UpperConstraint', Inf,...
	'Refinable', false);

% out = fitter.executeFit(rc);